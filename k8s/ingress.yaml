---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: agentic-devops-ingress
  annotations:
    # Use Azure Application Gateway Ingress Controller
    kubernetes.io/ingress.class: azure/application-gateway
    # SSL redirect disabled to allow HTTP access (set to "true" after certificate setup)
    appgw.ingress.kubernetes.io/ssl-redirect: "false"
    # Connection draining timeout
    appgw.ingress.kubernetes.io/connection-draining: "true"
    appgw.ingress.kubernetes.io/connection-draining-timeout: "30"
    # Backend protocol
    appgw.ingress.kubernetes.io/backend-protocol: "http"
    # Request timeout
    appgw.ingress.kubernetes.io/request-timeout: "30"
    # Health probe configuration for better reliability
    appgw.ingress.kubernetes.io/health-probe-interval: "30"
    appgw.ingress.kubernetes.io/health-probe-timeout: "5"
    appgw.ingress.kubernetes.io/health-probe-unhealthy-threshold: "3"
spec:
  rules:
    # Default rule for IP-based access (without hostname)
    # This allows accessing the app via Application Gateway Public IP
    - http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: agentic-devops-service
                port:
                  number: 80
